<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Checklist Operacional RPAS</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="css/style.css" />

  <!-- Biblioteca PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

  <!-- TELA 1 — SPLASH -->
  <section id="splash" class="screen active">
    <div class="logos">
      <span class="logo-placeholder">PCSC</span>
      <span class="logo-placeholder">SAER</span>
      <span class="logo-placeholder">COARP</span>
    </div>

    <h1>Checklist Operacional RPAS</h1>
    <p class="subtitle">COARP · NOARP · SAER · PCSC</p>

    <p class="warning">
      Este aplicativo não autoriza voo.<br>
      A decisão e a responsabilidade são do Piloto em Comando.
    </p>

    <button id="startBtn">Iniciar Checklist</button>
  </section>

  <!-- TELAS INTERMEDIÁRIAS (inalteradas) -->
  <!-- (todas as fases já existentes permanecem exatamente como estão) -->

  <!-- TELA FINAL — PDF -->
  <section id="pdfScreen" class="screen">
    <h2>Checklist Concluído</h2>
    <p class="subtitle">Documento operacional gerado para registro</p>

    <button id="generatePdfBtn">
      Gerar PDF Institucional
    </button>
  </section>

  <script src="js/app.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const { jsPDF } = window.jspdf;

      const btn = document.getElementById("generatePdfBtn");
      if (!btn) return;

      btn.addEventListener("click", () => {

        const data = JSON.parse(
          localStorage.getItem("checklistRPAS_session")
        );

        const pdf = new jsPDF();

        pdf.setFontSize(14);
        pdf.text("CHECKLIST OPERACIONAL RPAS", 20, 20);

        pdf.setFontSize(10);
        pdf.text(`Instituição: ${data.metadata.institution}`, 20, 30);
        pdf.text(`Doutrina: ${data.metadata.doctrine}`, 20, 36);

        pdf.text(`Piloto: ${data.metadata.pilot}`, 20, 46);
        pdf.text(`Observador: ${data.metadata.observer}`, 20, 52);
        pdf.text(`Unidade: ${data.metadata.unit}`, 20, 58);
        pdf.text(`RPAS: ${data.metadata.rpas}`, 20, 64);
        pdf.text(`Missão: ${data.metadata.missionType}`, 20, 70);

        pdf.text(`Início: ${data.metadata.startTime}`, 20, 82);
        pdf.text(`Término: ${data.metadata.endTime}`, 20, 88);

        let y = 100;
        pdf.text("Fases Concluídas:", 20, y);

        Object.entries(data.phases).forEach(([key, phase]) => {
          y += 8;
          pdf.text(
            `${key.toUpperCase()} – ${phase.completed ? "OK" : "NÃO CONCLUÍDA"} (${phase.completedAt})`,
            20,
            y
          );
        });

        y += 12;
        pdf.text(
          "Declaração:",
          20,
          y
        );

        y += 8;
        pdf.text(
          "Declaro que executei integralmente o checklist operacional RPAS conforme a doutrina vigente.",
          20,
          y,
          { maxWidth: 170 }
        );

        pdf.save("Checklist_Operacional_RPAS.pdf");
      });
    });
  </script>

</body>
</html>
